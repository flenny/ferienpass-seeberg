<!DOCTYPE html>
<html>

<head>
  <title>Ferienpass Seeberg - Anmeldung Ferienpass</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="shortcut icon" type="image/png" href="https://booking.ferienpass-seeberg.ch/ferienpass.webp">
  <!-- Include Bootstrap 5.3 Alpha 2 CSS -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha2/dist/css/bootstrap.min.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/js-sha256/0.9.0/sha256.min.js"></script>
  <!-- Include SHA-256 library -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
  <!-- Include CryptoJS library -->
  <script>
    // Load iframe if src was decrpyted previously and stored in localStorage
    if (localStorage.getItem("iframeSrc")) {
      document.getElementById("iframe").src = `${localStorage.getItem("iframeSrc")}${window.location.search}`;
      document.getElementById("iframe").style.display = "block";
    }
  </script>
</head>

<body>
  <div class="container mt-5">
    <form id="form" class="mt-4" style="display: none;">
      <h1 class="text-center">Ferienpass Seeberg - Anmeldung Ferienpass</h1>
      <div class="mb-3">
        <label for="username" class="form-label">Username:</label>
        <input type="text" class="form-control" id="username" name="username" autocomplete="username">
      </div>
      <div class="mb-3">
        <label for="password" class="form-label">Password:</label>
        <input type="password" class="form-control" id="password" name="password" autocomplete="current-password">
      </div>
      <button type="submit" class="btn btn-primary">Login</button>
    </form>
  </div>
  <iframe id="iframe"
    style="display:none; position:fixed; top:0; left:0; bottom:0; right:0; width:100%; height:100%; border:none; margin:0; padding:0; overflow:hidden; z-index:999999;"></iframe>

  <script>
    // Load iframe if src was decrpyted previously and stored in localStorage
    if (localStorage.getItem("iframeSrc")) {
      document.getElementById("iframe").src = `${localStorage.getItem("iframeSrc")}${window.location.search}`;
      document.getElementById("iframe").style.display = "block";
    }
    else {
      // Show the login form
      document.getElementById("form").style.display = "block";
    }

    form.onsubmit = async e => {
      e.preventDefault();
      const username = document.getElementById("username").value;
      const password = document.getElementById("password").value;

      // Check if username and password are not empty
      if (username === "" || password === "") {
        alert("Please enter both username and password.");
        return false;
      }

      // Hash username and password using SHA-256
      const hashedUsername = sha256(username);
      const hashedPassword = sha256(password);

      // Check if username is "ferienpass" and hashed password matches the expected hash
      if (hashedUsername.localeCompare("2F149CB830D6DAF68B1BFF7B8F29B01B8CC85D1CB7C87FE06D51FE3CD6367ED7", undefined, { sensitivity: 'accent' }) === 0 &&
        hashedPassword.localeCompare("1CB14D3982F507A7AF9F3337D4283F253F62B84EA65EFB2F32E913D07D80072C", undefined, { sensitivity: 'accent' }) === 0) {
        // Encrypt the iframe src using the password
        /*console.log(
          CryptoJS.AES.encrypt(
            "https://www.example.com",
            `${username}:${password}`).toString()
        )*/
        const encryptedSrc = "U2FsdGVkX19iWxcFbeZ0E9GgZVoIWY4HroevSbOYcraghQzZIa3EMauMOgIKb5kruYs8gQIC3z194oyF65SaRWtG82hKpmuN4eJ0SCTyuDWK/WSZ4FAAKJuiY/QGQLhQ+hNmA2Nnic5oJDjLKoAK32rmW1i9YK74WihPFEkzoSpvfBFehAoLl4QrlJnQ93Yn"
        const decryptedSrc = CryptoJS.AES.decrypt(encryptedSrc, `${username}:${password}`).toString(CryptoJS.enc.Utf8);

        // Save decrypted src to local storage
        localStorage.setItem("iframeSrc", decryptedSrc);

        // Show the iframe
        document.getElementById("iframe").style.display = "block";

        // Set the decrypted src as the iframe source
        // Append the original query string to the decrypted src
        document.getElementById("iframe").src = `${decryptedSrc}${window.location.search}`;
      }
    }
  </script>
</body>

</html>
